# üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ XTrack

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
3. [–ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–º–æ–¥—É–ª–∏-–∏-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
4. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
5. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
6. [–ù–∞–≤–∏–≥–∞—Ü–∏—è](#–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
7. [–°–µ—Ä–≤–∏—Å—ã –∏ —Ñ–æ–Ω–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞](#—Å–µ—Ä–≤–∏—Å—ã-–∏-—Ñ–æ–Ω–æ–≤–∞—è-—Ä–∞–±–æ—Ç–∞)
8. [API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#api-–∏-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
9. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)
10. [–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-—Ñ–∞–π–ª–∞–º–∏)
11. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
12. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**XTrack** - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è GPS-—Ç—Ä–µ–∫–æ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫, —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: Android (–º–∏–Ω–∏–º—É–º API 24, —Ü–µ–ª–µ–≤–æ–π API 34)
- **–Ø–∑—ã–∫**: Kotlin
- **UI Framework**: Jetpack Compose
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: MVVM + Clean Architecture
- **DI**: Hilt/Dagger
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: Room
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: Kotlin Coroutines + Flow
- **–ö–∞—Ä—Ç—ã**: Yandex MapKit

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|-----------|---------|
| **Core** | Kotlin | 1.9.24 |
| **UI** | Jetpack Compose | 2024.02.00 |
| **DI** | Hilt | 2.48 |
| **Database** | Room | 2.6.1 |
| **Navigation** | Navigation Compose | 2.7.5 |
| **Maps** | Yandex MapKit | 4.5.1-full |
| **Location** | Google Play Services Location | 21.0.1 |
| **Serialization** | Gson | 2.10.1 |
| **Async** | Coroutines | 1.7.3 |
| **Background** | WorkManager | 2.9.0 |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü–∞—Ç—Ç–µ—Ä–Ω MVVM

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Presentation Layer                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   Screens    ‚îÇ  ‚îÇ  ViewModels  ‚îÇ  ‚îÇ  Components  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  (Compose)   ‚îÇ‚Üê‚Üí‚îÇ   (State)    ‚îÇ‚Üê‚Üí‚îÇ   (Reusable) ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Domain Layer                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                         ‚îÇ
‚îÇ  ‚îÇ Repositories ‚îÇ  ‚îÇ   Use Cases  ‚îÇ                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         Data Layer                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   Database   ‚îÇ  ‚îÇ   Parsers    ‚îÇ  ‚îÇ   Services   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ    (Room)    ‚îÇ  ‚îÇ (GPX/JSON)   ‚îÇ  ‚îÇ  (Location)  ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤

```
com.xtrack/
‚îú‚îÄ‚îÄ data/                          # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ database/                  # Room DAO –∏ Database
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppSettingsDao.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrackDao.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrackPointDao.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MapNoteDao.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BufferedTrackPointDao.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LastLocationDao.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Converters.kt          # Type converters –¥–ª—è Room
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TrackingDatabase.kt    # –ì–ª–∞–≤–Ω–∞—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ model/                     # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Entities)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Track.kt               # –¢—Ä–µ–∫ (–º–∞—Ä—à—Ä—É—Ç)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrackPoint.kt          # –¢–æ—á–∫–∞ —Ç—Ä–µ–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MapNote.kt             # –ó–∞–º–µ—Ç–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppSettings.kt         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BufferedTrackPoint.kt  # –ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ç–æ—á–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LastLocation.kt        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–∑–∏—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Point.kt               # –ü—Ä–æ—Å—Ç–∞—è —Ç–æ—á–∫–∞ (lat/lng)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GpxTrack.kt            # GPX —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GeoJsonTrack.kt        # GeoJSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ parser/                    # –ü–∞—Ä—Å–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GpxParser.kt           # –ü–∞—Ä—Å–∏–Ω–≥ GPX
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GpxGenerator.kt        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è GPX
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GeoJsonParser.kt       # –ü–∞—Ä—Å–∏–Ω–≥ GeoJSON
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GeoJsonGenerator.kt    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è GeoJSON
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TrackImportParser.kt   # –ò–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ repository/                # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (Data Access)
‚îÇ       ‚îú‚îÄ‚îÄ TrackRepository.kt
‚îÇ       ‚îú‚îÄ‚îÄ SettingsRepository.kt
‚îÇ       ‚îú‚îÄ‚îÄ MapNoteRepository.kt
‚îÇ       ‚îú‚îÄ‚îÄ BufferedTrackPointRepository.kt
‚îÇ       ‚îî‚îÄ‚îÄ LastLocationRepository.kt
‚îÇ
‚îú‚îÄ‚îÄ di/                            # Dependency Injection
‚îÇ   ‚îú‚îÄ‚îÄ DatabaseModule.kt          # –ú–æ–¥—É–ª—å –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ ParserModule.kt            # –ú–æ–¥—É–ª—å –ø–∞—Ä—Å–µ—Ä–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ presentation/                  # –°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ screen/                    # –≠–∫—Ä–∞–Ω—ã Compose
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainScreen.kt          # –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (–∫–∞—Ä—Ç–∞ + –∑–∞–ø–∏—Å—å)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TracksListScreen.kt    # –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrackDetailScreen.kt   # –î–µ—Ç–∞–ª–∏ —Ç—Ä–µ–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsScreen.kt      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotesListScreen.kt     # –°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotesMapScreen.kt      # –ó–∞–º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NoteDetailScreen.kt    # –î–µ—Ç–∞–ª–∏ –∑–∞–º–µ—Ç–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddNoteScreen.kt       # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImportTrackScreen.kt   # –ò–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ErrorLogScreen.kt      # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ viewmodel/                 # ViewModel'—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TracksListViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrackDetailViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotesListViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotesMapViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NoteDetailViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddNoteViewModel.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImportTrackViewModel.kt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ExportNotesViewModel.kt
‚îÇ   ‚îú‚îÄ‚îÄ components/                # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MapView.kt             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã Yandex
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StatisticsCard.kt      # –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TrackItem.kt           # –≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ navigation/                # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TrackingNavigation.kt  # –ì—Ä–∞—Ñ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ theme/                     # –¢–µ–º–∞ Material Design 3
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Color.kt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Theme.kt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Type.kt
‚îÇ   ‚îî‚îÄ‚îÄ MainActivity.kt            # –ì–ª–∞–≤–Ω–∞—è Activity
‚îÇ
‚îú‚îÄ‚îÄ service/                       # –§–æ–Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ LocationTrackingService.kt # –°–µ—Ä–≤–∏—Å –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ BufferedPointsSyncService.kt # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ—á–µ–∫
‚îÇ
‚îú‚îÄ‚îÄ utils/                         # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ ErrorLogger.kt             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ GlobalExceptionHandler.kt  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ LocationUtils.kt           # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ NetworkUtils.kt            # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–µ—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ RateLimitedLogger.kt       # –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ ServiceUtils.kt            # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ XTrackApplication.kt           # Application –∫–ª–∞—Å—Å
```

---

## –ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Data Layer (–°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö)

#### 1.1 Database Module

**TrackingDatabase** - –≥–ª–∞–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Room —Å –≤–µ—Ä—Å–∏–µ–π 11.

**–¢–∞–±–ª–∏—Ü—ã:**
- `tracks` - —Ç—Ä–µ–∫–∏/–º–∞—Ä—à—Ä—É—Ç—ã
- `track_points` - GPS —Ç–æ—á–∫–∏ —Ç—Ä–µ–∫–æ–≤
- `map_notes` - –∑–∞–º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
- `app_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `last_location` - –ø–æ—Å–ª–µ–¥–Ω—è—è –∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
- `buffered_track_points` - –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- –í–µ—Ä—Å–∏–∏ 1-11 —Å –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- Fallback –Ω–∞ destructive migration –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

#### 1.2 Repositories

**TrackRepository:**
```kotlin
// –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç—Ä–µ–∫–∞–º–∏
- getAllTracks(): Flow<List<Track>>
- getTrackById(id: String): Flow<Track?>
- getActiveTrack(): Flow<Track?>
- insertTrack(track: Track)
- updateTrack(track: Track)
- deleteTrack(trackId: String)
- getTrackPoints(trackId: String): Flow<List<TrackPoint>>
- insertTrackPoint(point: TrackPoint)
- deleteTrackPoints(trackId: String)
```

**SettingsRepository:**
```kotlin
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- getSettings(): Flow<AppSettings>
- updateSettings(settings: AppSettings)
- getLocationAccuracy(): Flow<LocationAccuracy>
- updateLocationAccuracy(accuracy: LocationAccuracy)
```

**MapNoteRepository:**
```kotlin
// –†–∞–±–æ—Ç–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
- getAllNotes(): Flow<List<MapNote>>
- getNoteById(id: String): Flow<MapNote?>
- getNotesForTrack(trackId: String): Flow<List<MapNote>>
- insertNote(note: MapNote)
- updateNote(note: MapNote)
- deleteNote(noteId: String)
```

**BufferedTrackPointRepository:**
```kotlin
// –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ—á–µ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
- insertBufferedPoint(point: BufferedTrackPoint)
- getUnsyncedPoints(): List<BufferedTrackPoint>
- markAsSynced(pointId: String)
- deleteBufferedPoints(trackId: String)
```

#### 1.3 Parsers

**GpxParser & GpxGenerator:**
- –ü–∞—Ä—Å–∏–Ω–≥ GPX 1.1 —Ñ–∞–π–ª–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è GPX —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (—Ç—Ä–µ–∫–∏, waypoints)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (extensions)

**GeoJsonParser & GeoJsonGenerator:**
- –ü–∞—Ä—Å–∏–Ω–≥ GeoJSON Feature Collections
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è GeoJSON LineString –¥–ª—è —Ç—Ä–µ–∫–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ properties –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

**TrackImportParser:**
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç GPX –∏ GeoJSON
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### 2. Presentation Layer (–°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)

#### 2.1 Screens (–≠–∫—Ä–∞–Ω—ã)

**MainScreen** - –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã (Yandex MapKit)
- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—å—é (–°—Ç–∞—Ä—Ç/–°—Ç–æ–ø/–ü–∞—É–∑–∞)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –º–µ—Ç—Ä–∏–∫ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –≤—Ä–µ–º—è, —Å–∫–æ—Ä–æ—Å—Ç—å)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ (–¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

**TracksListScreen** - —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤ —Å –ø—Ä–µ–≤—å—é
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤ (GPX, GeoJSON)
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º —Ç—Ä–µ–∫–∞
- –ò–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤
```

**TrackDetailScreen** - –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–∫–∞
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  * –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ
  * –í—Ä–µ–º—è
  * –°—Ä–µ–¥–Ω—è—è/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
  * –ù–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã
  * –ì—Ä–∞—Ñ–∏–∫ –≤—ã—Å–æ—Ç—ã/—Å–∫–æ—Ä–æ—Å—Ç–∏
- –°–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ –º–∞—Ä—à—Ä—É—Ç–∞
- –≠–∫—Å–ø–æ—Ä—Ç –≤ GPX/GeoJSON
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
```

**SettingsScreen** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GPS:
  * –¢–æ—á–Ω–æ—Å—Ç—å (HIGH/BALANCED/LOW_POWER)
  * –ò–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø–∏—Å–∏ (–º—Å)
  * –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–º)
  * –ü–æ—Ä–æ–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏ (–º)
- –ê–≤—Ç–æ–ø–∞—É–∑–∞:
  * –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ
  * –ü–æ—Ä–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏
  * –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã
- –≠–∫—Å–ø–æ—Ä—Ç:
  * –§–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (GPX/GeoJSON)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
  * –ò–Ω—Ç–µ—Ä–≤–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
  * –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
  * –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
  * –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
  * –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∞–º–∏:
  * –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–º–µ—Ç–æ–∫
  * –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫
```

**NotesListScreen** - —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–º–µ—Ç–æ–∫ —Å –ø—Ä–µ–≤—å—é
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É (—Ç–µ–∫—Å—Ç/—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º –∑–∞–º–µ—Ç–∫–∏
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–º–µ—Ç–∫–µ –Ω–∞ –∫–∞—Ä—Ç–µ
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
- –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫
```

**NotesMapScreen** - –∑–∞–º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–º–µ—Ç–æ–∫
- –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–µ
- –ü—Ä–µ–≤—å—é –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º –∑–∞–º–µ—Ç–∫–∏
```

**NoteDetailScreen** - –¥–µ—Ç–∞–ª–∏ –∑–∞–º–µ—Ç–∫–∏
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–º–µ—Ç–∫–µ
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–º–µ—Ç–∫–µ –Ω–∞ –∫–∞—Ä—Ç–µ
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
```

**AddNoteScreen** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
- –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ (–∫–∞–º–µ—Ä–∞/–≥–∞–ª–µ—Ä–µ—è)
- –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ (–∫–∞–º–µ—Ä–∞/–≥–∞–ª–µ—Ä–µ—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ–∫—É—â–µ–º—É —Ç—Ä–µ–∫—É
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
```

**ImportTrackScreen** - –∏–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–∞
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –í—ã–±–æ—Ä GPX/GeoJSON —Ñ–∞–π–ª–∞
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–µ–∫–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ò–º–ø–æ—Ä—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```

**ErrorLogScreen** - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
```kotlin
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é (ERROR/WARNING/INFO)
- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
- –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
- –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
```

#### 2.2 ViewModels

–í—Å–µ ViewModel'—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- `StateFlow` –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è UI
- `SharedFlow` –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
- –ö–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Hilt –¥–ª—è Dependency Injection

**–û—Å–Ω–æ–≤–Ω—ã–µ ViewModel'—ã:**

```kotlin
MainViewModel:
- currentTrack: StateFlow<Track?>
- isRecording: StateFlow<Boolean>
- isPaused: StateFlow<Boolean>
- currentMetrics: StateFlow<TrackMetrics>
- startRecording()
- stopRecording()
- pauseRecording()
- resumeRecording()
- addNote(lat: Double, lng: Double)

TracksListViewModel:
- tracks: StateFlow<List<Track>>
- searchQuery: StateFlow<String>
- deleteTrack(trackId: String)
- exportTrack(trackId: String, format: ExportFormat)
- importTrack(uri: Uri)

TrackDetailViewModel:
- track: StateFlow<Track?>
- trackPoints: StateFlow<List<TrackPoint>>
- statistics: StateFlow<TrackStatistics>
- exportTrack(format: ExportFormat)
- deleteTrack()

SettingsViewModel:
- settings: StateFlow<AppSettings>
- updateSettings(settings: AppSettings)
- resetToDefaults()
- exportLogs()
- clearCache()
```

#### 2.3 Components

**MapView** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã Yandex MapKit
```kotlin
@Composable
fun MapView(
    modifier: Modifier = Modifier,
    currentLocation: Point?,
    trackPoints: List<TrackPoint>,
    mapNotes: List<MapNote>,
    onMapClick: (Point) -> Unit,
    onMapLongClick: (Point) -> Unit,
    followUser: Boolean = true,
    centerOnPoint: Point? = null
)
```

**StatisticsCard** - –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```kotlin
@Composable
fun StatisticsCard(
    title: String,
    value: String,
    icon: ImageVector,
    modifier: Modifier = Modifier
)
```

**TrackItem** - —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–∫–æ–≤
```kotlin
@Composable
fun TrackItem(
    track: Track,
    onClick: () -> Unit,
    onDelete: () -> Unit,
    onExport: (ExportFormat) -> Unit
)
```

### 3. Service Layer (–°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤)

#### 3.1 LocationTrackingService

**Foreground —Å–µ—Ä–≤–∏—Å** –¥–ª—è –∑–∞–ø–∏—Å–∏ GPS-—Ç—Ä–µ–∫–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∑–∞–ø–∏—Å—å GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –†–∞–±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—É–∑—ã/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ—á–µ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞ –ø—Ä–∏ –Ω–∏–∑–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏:**
```kotlin
LocationRequest.PRIORITY_HIGH_ACCURACY     // –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (GPS)
LocationRequest.PRIORITY_BALANCED_POWER_ACCURACY  // –ë–∞–ª–∞–Ω—Å (GPS + Network)
LocationRequest.PRIORITY_LOW_POWER         // –ù–∏–∑–∫–æ–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
```

**–õ–æ–≥–∏–∫–∞ –∑–∞–ø–∏—Å–∏ —Ç–æ—á–µ–∫:**
```kotlin
1. –ü–æ–ª—É—á–µ–Ω–∏–µ GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Ç FusedLocationProvider
2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–æ—á–Ω–æ—Å—Ç–∏ (accuracyThresholdMeters)
3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é (minDistanceMeters)
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –ë–î (track_points)
5. –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏ (buffered_track_points)
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Ç—Ä–µ–∫–∞ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –≤—Ä–µ–º—è, –≤—ã—Å–æ—Ç–∞)
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ foreground —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü–∞—É–∑–∞/–°—Ç–æ–ø) –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 3.2 BufferedPointsSyncService

**–°–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫.

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
- –ü–µ—Ä–µ–Ω–æ—Å —Ç–æ—á–µ–∫ –∏–∑ buffered_track_points –≤ track_points
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Ç—Ä–µ–∫–æ–≤ –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- Rate limiting –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 4. Utils Layer (–£—Ç–∏–ª–∏—Ç—ã)

#### 4.1 ErrorLogger

**–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫** –≤ —Ñ–∞–π–ª.

```kotlin
ErrorLogger.logError(context, exception, message)
ErrorLogger.logMessage(context, message, LogLevel.INFO)
ErrorLogger.getLogFile(context): File
ErrorLogger.clearLogs(context)
```

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤:**
- `ERROR` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- `WARNING` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `INFO` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–∞:**
```
2024-10-10 15:30:45 [ERROR] MainActivity: –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
java.lang.Exception: MapKit not initialized
    at com.xtrack.presentation.MainActivity.onCreate(...)
    ...
```

#### 4.2 GlobalExceptionHandler

**–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

```kotlin
GlobalExceptionHandler.install(application)
```

–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Ö –≤ —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –ø–∞–¥–µ–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

#### 4.3 LocationUtils

**–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π:**

```kotlin
LocationUtils.calculateDistance(lat1, lng1, lat2, lng2): Float
LocationUtils.calculateBearing(lat1, lng1, lat2, lng2): Float
LocationUtils.calculateSpeed(distance, timeDelta): Float
LocationUtils.formatDistance(meters): String
LocationUtils.formatSpeed(mps): String
LocationUtils.formatDuration(seconds): String
```

#### 4.4 NetworkUtils

**–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ç—å—é:**

```kotlin
NetworkUtils.isNetworkAvailable(context): Boolean
NetworkUtils.startNetworkMonitoring(context, callback)
NetworkUtils.stopNetworkMonitoring(context)
```

#### 4.5 RateLimitedLogger

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã:**

```kotlin
RateLimitedLogger.log(tag, message, intervalMs)
```

–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∞–º –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö.

#### 4.6 ServiceUtils

**–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏:**

```kotlin
ServiceUtils.isServiceRunning(context, serviceClass): Boolean
ServiceUtils.startForegroundService(context, intent)
ServiceUtils.stopService(context, serviceClass)
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ó–∞–ø–∏—Å—å GPS-—Ç—Ä–µ–∫–æ–≤

**–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°—Ç–∞—Ä—Ç"
2. –ó–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ç—Ä–µ–∫ –≤ –ë–î
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è LocationTrackingService
5. –°–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
6. –¢–æ—á–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
7. –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
8. –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ:
   - –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å
   - –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
   - –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è GPX/GeoJSON —Ñ–∞–π–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ—á–µ–∫:**
- –ü–æ —Ç–æ—á–Ω–æ—Å—Ç–∏ (accuracy < accuracyThresholdMeters)
- –ü–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é (distance > minDistanceMeters)
- –ü–æ –≤—Ä–µ–º–µ–Ω–∏ (interval >= locationIntervalMs)

**–ú–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–µ–∫–∞:**
- –û–±—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)
- –í—Ä–µ–º—è –≤ –¥–≤–∏–∂–µ–Ω–∏–∏ (—á—á:–º–º:—Å—Å)
- –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)
- –ù–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã (–º)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫

### 2. –†–∞–±–æ—Ç–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏

**–¢–∏–ø—ã –∑–∞–º–µ—Ç–æ–∫:**
- **TEXT** - —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞
- **PHOTO** - –∑–∞–º–µ—Ç–∫–∞ —Å —Ñ–æ—Ç–æ
- **VIDEO** - –∑–∞–º–µ—Ç–∫–∞ —Å –≤–∏–¥–µ–æ
- **MIXED** - —Ç–µ–∫—Å—Ç + –º–µ–¥–∏–∞

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏:**
1. –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è AddNoteScreen
3. –í–≤–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
6. –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É —Ç—Ä–µ–∫—É (–µ—Å–ª–∏ –∏–¥–µ—Ç –∑–∞–ø–∏—Å—å)

**–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–º–µ—Ç–æ–∫:**
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–º–µ—Ç–æ–∫ (NotesListScreen)
- –ó–∞–º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ (NotesMapScreen) —Å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (NoteDetailScreen)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –∏ —Ç—Ä–µ–∫—É

### 3. –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç

**–≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤:**

**GPX —Ñ–æ—Ä–º–∞—Ç:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="XTrack">
  <metadata>
    <name>–¢—Ä–µ–∫ 2024-10-10</name>
    <time>2024-10-10T12:00:00Z</time>
  </metadata>
  <trk>
    <name>–¢—Ä–µ–∫ 2024-10-10</name>
    <trkseg>
      <trkpt lat="55.751244" lon="37.618423">
        <ele>150.5</ele>
        <time>2024-10-10T12:00:00Z</time>
      </trkpt>
      ...
    </trkseg>
  </trk>
</gpx>
```

**GeoJSON —Ñ–æ—Ä–º–∞—Ç:**
```json
{
  "type": "FeatureCollection",
  "features": [{
    "type": "Feature",
    "geometry": {
      "type": "LineString",
      "coordinates": [
        [37.618423, 55.751244, 150.5],
        ...
      ]
    },
    "properties": {
      "name": "–¢—Ä–µ–∫ 2024-10-10",
      "time": "2024-10-10T12:00:00Z",
      "distance": 5420.5,
      "duration": 1800
    }
  }]
}
```

**–ò–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPX 1.0/1.1
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GeoJSON FeatureCollection
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GPS

**–¢–æ—á–Ω–æ—Å—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:**
- **HIGH_ACCURACY** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–æ–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ (GPS)
- **BALANCED** - –±–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è (GPS + Network)
- **LOW_POWER** - –Ω–∏–∑–∫–æ–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, –Ω–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

**–ò–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø–∏—Å–∏:**
- –ú–∏–Ω–∏–º—É–º: 1000 –º—Å (1 —Å–µ–∫)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5000 –º—Å (5 —Å–µ–∫)
- –ú–∞–∫—Å–∏–º—É–º: 60000 –º—Å (1 –º–∏–Ω)

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ:**
- –ú–∏–Ω–∏–º—É–º: 0 –º
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 –º
- –ú–∞–∫—Å–∏–º—É–º: 100 –º

**–ü–æ—Ä–æ–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏:**
- –ú–∏–Ω–∏–º—É–º: 10 –º
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50 –º
- –ú–∞–∫—Å–∏–º—É–º: 200 –º

### 5. –ê–≤—Ç–æ–ø–∞—É–∑–∞

**–õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–ø–∞—É–∑—ã:**
1. –°–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ (autoPauseSpeedThreshold)
2. –û–∂–∏–¥–∞–Ω–∏–µ autoPauseDurationSec —Å–µ–∫—É–Ω–¥
3. –ï—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å - –ø–∞—É–∑–∞
4. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **–ü–æ—Ä–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏**: 0.5 - 5.0 –º/—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0 –º/—Å)
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã**: 10 - 120 —Å–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 —Å–µ–∫)

### 6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (100-5000 –º)
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –º–µ—Ç—Ä–∏–∫ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–≤–µ—Ä—Å–∏—è 11)

#### –¢–∞–±–ª–∏—Ü–∞: tracks
```sql
CREATE TABLE tracks (
    id TEXT PRIMARY KEY NOT NULL,
    name TEXT NOT NULL,
    startedAt TEXT NOT NULL,        -- ISO 8601 timestamp
    endedAt TEXT,                    -- ISO 8601 timestamp
    distanceMeters REAL NOT NULL,
    durationSec INTEGER NOT NULL,
    elevationGainMeters REAL NOT NULL DEFAULT 0.0,
    gpxPath TEXT,
    geojsonPath TEXT,
    isRecording INTEGER NOT NULL DEFAULT 0
)
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY on `id`
- INDEX on `startedAt` (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
- INDEX on `isRecording` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞)

#### –¢–∞–±–ª–∏—Ü–∞: track_points
```sql
CREATE TABLE track_points (
    id TEXT PRIMARY KEY NOT NULL,
    trackId TEXT NOT NULL,           -- FK to tracks
    timestamp INTEGER NOT NULL,       -- Unix timestamp (ms)
    latitude REAL NOT NULL,
    longitude REAL NOT NULL,
    altitude REAL,
    speed REAL,
    bearing REAL,
    accuracy REAL NOT NULL,
    FOREIGN KEY (trackId) REFERENCES tracks(id) ON DELETE CASCADE
)
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY on `id`
- INDEX on `trackId` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–æ—á–µ–∫ —Ç—Ä–µ–∫–∞)
- INDEX on `timestamp` (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)

#### –¢–∞–±–ª–∏—Ü–∞: map_notes
```sql
CREATE TABLE map_notes (
    id TEXT PRIMARY KEY NOT NULL,
    trackId TEXT NOT NULL,           -- FK to tracks
    latitude REAL NOT NULL,
    longitude REAL NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    timestamp TEXT NOT NULL,         -- ISO 8601 timestamp
    noteType TEXT NOT NULL,          -- TEXT, PHOTO, VIDEO, MIXED
    mediaPath TEXT,
    mediaType TEXT,                  -- PHOTO, VIDEO
    FOREIGN KEY (trackId) REFERENCES tracks(id) ON DELETE CASCADE
)
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY on `id`
- INDEX on `trackId`
- INDEX on `noteType`

#### –¢–∞–±–ª–∏—Ü–∞: app_settings
```sql
CREATE TABLE app_settings (
    id INTEGER PRIMARY KEY NOT NULL DEFAULT 1,
    locationAccuracy TEXT NOT NULL DEFAULT 'BALANCED',
    locationIntervalMs INTEGER NOT NULL DEFAULT 5000,
    minDistanceMeters REAL NOT NULL DEFAULT 10.0,
    accuracyThresholdMeters REAL NOT NULL DEFAULT 50.0,
    autoPauseEnabled INTEGER NOT NULL DEFAULT 0,
    autoPauseSpeedThreshold REAL NOT NULL DEFAULT 1.0,
    autoPauseDurationSec INTEGER NOT NULL DEFAULT 30,
    defaultExportFormat TEXT NOT NULL DEFAULT 'GPX',
    appExitState TEXT NOT NULL DEFAULT 'STOPPED',
    distanceNotificationIntervalMeters INTEGER NOT NULL DEFAULT 1000,
    distanceNotificationsEnabled INTEGER NOT NULL DEFAULT 0
)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å —Å `id = 1`.

#### –¢–∞–±–ª–∏—Ü–∞: last_location
```sql
CREATE TABLE last_location (
    id INTEGER PRIMARY KEY NOT NULL DEFAULT 1,
    latitude REAL NOT NULL,
    longitude REAL NOT NULL,
    timestamp TEXT NOT NULL,         -- ISO 8601 timestamp
    accuracy REAL
)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å —Å `id = 1` (–ø–æ—Å–ª–µ–¥–Ω—è—è –∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è).

#### –¢–∞–±–ª–∏—Ü–∞: buffered_track_points
```sql
CREATE TABLE buffered_track_points (
    id TEXT PRIMARY KEY NOT NULL,
    trackId TEXT NOT NULL,
    timestamp INTEGER NOT NULL,      -- Unix timestamp (ms)
    latitude REAL NOT NULL,
    longitude REAL NOT NULL,
    altitude REAL,
    speed REAL,
    bearing REAL,
    accuracy REAL NOT NULL,
    isSynced INTEGER NOT NULL DEFAULT 0,
    createdAt INTEGER NOT NULL       -- Unix timestamp (ms)
)
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY on `id`
- INDEX on `trackId`
- INDEX on `isSynced` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫)

### –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

```
tracks (1) ‚îÄ‚îÄ< (N) track_points
tracks (1) ‚îÄ‚îÄ< (N) map_notes
tracks (1) ‚îÄ‚îÄ< (N) buffered_track_points
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π:**

| –í–µ—Ä—Å–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| 1‚Üí2 | –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `map_notes` |
| 2‚Üí3 | –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `last_location` |
| 3‚Üí4 | –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `wasRecordingOnExit` –≤ `app_settings` |
| 4‚Üí5 | –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `buffered_track_points` |
| 5‚Üí6 | –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ |
| 6‚Üí7 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã `app_settings` |
| 7‚Üí8 | –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `elevationGainMeters` –≤ `tracks` |
| 8‚Üí9 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö—ç—à–∞ —Å—Ö–µ–º—ã |
| 9‚Üí10 | –î–æ–±–∞–≤–ª–µ–Ω—ã TypeConverters –¥–ª—è enum |
| 10‚Üí11 | –ó–∞–º–µ–Ω–∞ `wasRecordingOnExit` –Ω–∞ `appExitState` |

---

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

### –ì—Ä–∞—Ñ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    main     ‚îÇ (MainScreen)
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚ñº                  ‚ñº                  ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ  tracks  ‚îÇ      ‚îÇ settings ‚îÇ      ‚îÇadd_note/{lat}‚îÇ
  ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ      ‚îÇ     /{lng}   ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                 ‚îÇ
       ‚îÇ                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ error_logs
       ‚îÇ                 ‚îÇ
       ‚îÇ                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ notes_list ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚ñ∫ note_detail/{id}
       ‚îÇ                 ‚îÇ                    ‚îÇ
       ‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ notes_map ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ track_detail/{id}
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ import_track
```

### –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

| –ú–∞—Ä—à—Ä—É—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –≠–∫—Ä–∞–Ω |
|---------|-----------|-------|
| `main` | - | MainScreen |
| `tracks` | - | TracksListScreen |
| `track_detail/{trackId}` | trackId: String | TrackDetailScreen |
| `import_track` | - | ImportTrackScreen |
| `settings` | - | SettingsScreen |
| `error_logs` | - | ErrorLogScreen |
| `notes_list` | - | NotesListScreen |
| `notes_map` | - | NotesMapScreen |
| `notes_map_center` | - | NotesMapScreen (centered) |
| `notes_map_note/{noteId}` | noteId: String | NotesMapScreen (centered on note) |
| `note_detail/{noteId}` | noteId: String | NoteDetailScreen |
| `add_note/{lat}/{lng}` | lat: Double, lng: Double | AddNoteScreen |

### –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

```kotlin
// –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ø–∏—Å–∫—É —Ç—Ä–µ–∫–æ–≤
navController.navigate("tracks")

// –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º —Ç—Ä–µ–∫–∞
navController.navigate("track_detail/$trackId")

// –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∑–∞–º–µ—Ç–∫–∏
navController.navigate("add_note/$latitude/$longitude")

// –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
navController.popBackStack()

// –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
navController.popBackStack("main", inclusive = false)
```

---

## –°–µ—Ä–≤–∏—Å—ã –∏ —Ñ–æ–Ω–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞

### LocationTrackingService

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª:**

```
onCreate()
   ‚îú‚îÄ‚ñ∫ –°–æ–∑–¥–∞–Ω–∏–µ NotificationChannel
   ‚îú‚îÄ‚ñ∫ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FusedLocationProviderClient
   ‚îú‚îÄ‚ñ∫ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LocationCallback
   ‚îî‚îÄ‚ñ∫ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–∏

onStartCommand(intent)
   ‚îú‚îÄ‚ñ∫ startForeground() - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫
   ‚îî‚îÄ‚ñ∫ ACTION_START_RECORDING
       ‚îú‚îÄ‚ñ∫ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–∫–∞
       ‚îú‚îÄ‚ñ∫ –ó–∞–ø—Ä–æ—Å GPS-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
       ‚îî‚îÄ‚ñ∫ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   
   ‚îî‚îÄ‚ñ∫ ACTION_STOP_RECORDING
       ‚îú‚îÄ‚ñ∫ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ GPS-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
       ‚îú‚îÄ‚ñ∫ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
       ‚îú‚îÄ‚ñ∫ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è GPX/GeoJSON
       ‚îî‚îÄ‚ñ∫ stopForeground()

onDestroy()
   ‚îú‚îÄ‚ñ∫ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ GPS-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   ‚îú‚îÄ‚ñ∫ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–∏
   ‚îî‚îÄ‚ñ∫ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
```

**LocationCallback:**

```kotlin
override fun onLocationResult(result: LocationResult) {
    for (location in result.locations) {
        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏
        if (location.accuracy > accuracyThreshold) continue
        
        // 2. –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–∏
        val distance = calculateDistance(lastLocation, location)
        
        // 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
        if (distance < minDistance) continue
        
        // 4. –°–æ–∑–¥–∞–Ω–∏–µ TrackPoint
        val point = TrackPoint(
            id = UUID.randomUUID().toString(),
            trackId = currentTrack.id,
            timestamp = location.time,
            latitude = location.latitude,
            longitude = location.longitude,
            altitude = location.altitude,
            speed = location.speed,
            bearing = location.bearing,
            accuracy = location.accuracy
        )
        
        // 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        if (isNetworkAvailable()) {
            trackRepository.insertTrackPoint(point)
        } else {
            bufferedPointsRepository.insertBufferedPoint(point)
        }
        
        // 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
        updateTrackMetrics(distance, location)
        
        // 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        updateNotification()
        
        lastLocation = location
    }
}
```

**Foreground Notification:**

```kotlin
NotificationCompat.Builder(context, CHANNEL_ID)
    .setContentTitle("–ó–∞–ø–∏—Å—å —Ç—Ä–µ–∫–∞")
    .setContentText("–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 5.2 –∫–º ‚Ä¢ –í—Ä–µ–º—è: 01:15:30")
    .setSmallIcon(R.drawable.ic_location)
    .setOngoing(true)
    .setPriority(NotificationCompat.PRIORITY_LOW)
    .addAction(pauseAction)  // –ü–∞—É–∑–∞
    .addAction(stopAction)   // –°—Ç–æ–ø
    .setContentIntent(mainActivityIntent)
```

### BufferedPointsSyncService

**–õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

```kotlin
class BufferedPointsSyncService @Inject constructor(
    private val bufferedPointsRepository: BufferedTrackPointRepository,
    private val trackRepository: TrackRepository,
    private val networkUtils: NetworkUtils
) {
    
    suspend fun syncBufferedPoints() {
        if (!networkUtils.isNetworkAvailable()) {
            return
        }
        
        val unsyncedPoints = bufferedPointsRepository.getUnsyncedPoints()
        
        for (point in unsyncedPoints) {
            try {
                // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ TrackPoint
                val trackPoint = TrackPoint(
                    id = point.id,
                    trackId = point.trackId,
                    timestamp = point.timestamp,
                    latitude = point.latitude,
                    longitude = point.longitude,
                    altitude = point.altitude,
                    speed = point.speed,
                    bearing = point.bearing,
                    accuracy = point.accuracy
                )
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –ë–î
                trackRepository.insertTrackPoint(trackPoint)
                
                // –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
                bufferedPointsRepository.markAsSynced(point.id)
                
            } catch (e: Exception) {
                ErrorLogger.logError(context, e, "Failed to sync point ${point.id}")
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Ç—Ä–µ–∫–æ–≤
        updateTrackMetrics()
    }
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏:**

```kotlin
private fun startNetworkMonitoring() {
    val networkCallback = object : ConnectivityManager.NetworkCallback() {
        override fun onAvailable(network: Network) {
            lifecycleScope.launch {
                bufferedPointsSyncService.syncBufferedPoints()
            }
        }
    }
    
    val connectivityManager = getSystemService(ConnectivityManager::class.java)
    connectivityManager.registerDefaultNetworkCallback(networkCallback)
}
```

---

## API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Yandex MapKit

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**

```kotlin
// –í XTrackApplication.onCreate()
MapKitFactory.setApiKey(apiKey)
MapKitFactory.initialize(this)
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Compose:**

```kotlin
@Composable
fun MapView(
    modifier: Modifier = Modifier,
    currentLocation: Point?,
    trackPoints: List<TrackPoint>,
    mapNotes: List<MapNote>,
    onMapClick: (Point) -> Unit = {},
    onMapLongClick: (Point) -> Unit = {}
) {
    AndroidView(
        factory = { context ->
            MapView(context).apply {
                map.apply {
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ä—Ç—ã
                    isRotateGesturesEnabled = true
                    isScrollGesturesEnabled = true
                    isZoomGesturesEnabled = true
                    isTiltGesturesEnabled = true
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                    addInputListener(object : InputListener {
                        override fun onMapTap(map: Map, point: Point) {
                            onMapClick(point)
                        }
                        
                        override fun onMapLongTap(map: Map, point: Point) {
                            onMapLongClick(point)
                        }
                    })
                }
            }
        },
        update = { mapView ->
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
            updatePolyline(mapView, trackPoints)
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –∑–∞–º–µ—Ç–æ–∫
            updateMarkers(mapView, mapNotes)
            
            // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
            currentLocation?.let {
                mapView.map.move(
                    CameraPosition(it, 16.0f, 0.0f, 0.0f),
                    Animation(Animation.Type.SMOOTH, 1.0f),
                    null
                )
            }
        }
    )
}
```

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞:**

```kotlin
private fun updatePolyline(mapView: MapView, points: List<TrackPoint>) {
    val polylinePoints = points.map { Point(it.latitude, it.longitude) }
    
    val polyline = Polyline(polylinePoints)
    
    val polylineOptions = PolylineMapObject().apply {
        geometry = polyline
        strokeColor = Color.BLUE
        strokeWidth = 5.0f
        outlineColor = Color.WHITE
        outlineWidth = 1.0f
    }
    
    mapView.map.mapObjects.addPolyline(polylineOptions)
}
```

**–ú–∞—Ä–∫–µ—Ä—ã –∑–∞–º–µ—Ç–æ–∫:**

```kotlin
private fun updateMarkers(mapView: MapView, notes: List<MapNote>) {
    notes.forEach { note ->
        val marker = mapView.map.mapObjects.addPlacemark(
            Point(note.latitude, note.longitude)
        ).apply {
            // –ò–∫–æ–Ω–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            setIcon(ImageProvider.fromResource(context, getIconForNoteType(note.noteType)))
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            addTapListener { _, _ ->
                onNoteClick(note)
                true
            }
            
            // –¢–µ–∫—Å—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ä–µ
            setText(note.title)
        }
    }
}
```

### Google Play Services Location

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ LocationRequest:**

```kotlin
val locationRequest = LocationRequest.create().apply {
    interval = settings.locationIntervalMs
    fastestInterval = settings.locationIntervalMs / 2
    priority = when (settings.locationAccuracy) {
        LocationAccuracy.HIGH_ACCURACY -> LocationRequest.PRIORITY_HIGH_ACCURACY
        LocationAccuracy.BALANCED -> LocationRequest.PRIORITY_BALANCED_POWER_ACCURACY
        LocationAccuracy.LOW_POWER -> LocationRequest.PRIORITY_LOW_POWER
    }
    maxWaitTime = settings.locationIntervalMs * 2
}
```

**–ó–∞–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**

```kotlin
if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) 
    == PackageManager.PERMISSION_GRANTED) {
    
    fusedLocationClient.requestLocationUpdates(
        locationRequest,
        locationCallback,
        Looper.getMainLooper()
    )
}
```

### Room Database

**TypeConverters:**

```kotlin
class Converters {
    @TypeConverter
    fun fromInstant(value: Instant?): String? = value?.toString()
    
    @TypeConverter
    fun toInstant(value: String?): Instant? = value?.let { Instant.parse(it) }
    
    @TypeConverter
    fun fromLocationAccuracy(value: LocationAccuracy): String = value.name
    
    @TypeConverter
    fun toLocationAccuracy(value: String): LocationAccuracy = 
        LocationAccuracy.valueOf(value)
    
    @TypeConverter
    fun fromExportFormat(value: ExportFormat): String = value.name
    
    @TypeConverter
    fun toExportFormat(value: String): ExportFormat = 
        ExportFormat.valueOf(value)
    
    @TypeConverter
    fun fromNoteType(value: NoteType): String = value.name
    
    @TypeConverter
    fun toNoteType(value: String): NoteType = 
        NoteType.valueOf(value)
    
    @TypeConverter
    fun fromMediaType(value: MediaType?): String? = value?.name
    
    @TypeConverter
    fun toMediaType(value: String?): MediaType? = 
        value?.let { MediaType.valueOf(it) }
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### StateFlow –∏ SharedFlow

**–ü–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ ViewModel:**

```kotlin
class MainViewModel @Inject constructor(
    private val trackRepository: TrackRepository,
    private val settingsRepository: SettingsRepository
) : ViewModel() {
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ UI (StateFlow)
    private val _uiState = MutableStateFlow(MainUiState())
    val uiState: StateFlow<MainUiState> = _uiState.asStateFlow()
    
    // –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (SharedFlow)
    private val _events = MutableSharedFlow<MainEvent>()
    val events: SharedFlow<MainEvent> = _events.asSharedFlow()
    
    // –î–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (StateFlow)
    val currentTrack: StateFlow<Track?> = trackRepository
        .getActiveTrack()
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(5000),
            initialValue = null
        )
    
    // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
    fun startRecording() {
        viewModelScope.launch {
            try {
                val track = createNewTrack()
                trackRepository.insertTrack(track)
                startLocationService()
                _events.emit(MainEvent.RecordingStarted)
            } catch (e: Exception) {
                _events.emit(MainEvent.Error(e.message ?: "Unknown error"))
            }
        }
    }
}
```

**UI State:**

```kotlin
data class MainUiState(
    val isRecording: Boolean = false,
    val isPaused: Boolean = false,
    val currentDistance: Float = 0f,
    val currentDuration: Long = 0L,
    val currentSpeed: Float = 0f,
    val isLoading: Boolean = false,
    val error: String? = null
)
```

**Events:**

```kotlin
sealed class MainEvent {
    object RecordingStarted : MainEvent()
    object RecordingStopped : MainEvent()
    object RecordingPaused : MainEvent()
    object RecordingResumed : MainEvent()
    data class Error(val message: String) : MainEvent()
    data class Success(val message: String) : MainEvent()
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Compose

```kotlin
@Composable
fun MainScreen(viewModel: MainViewModel) {
    val uiState by viewModel.uiState.collectAsState()
    val currentTrack by viewModel.currentTrack.collectAsState()
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
    LaunchedEffect(Unit) {
        viewModel.events.collect { event ->
            when (event) {
                is MainEvent.RecordingStarted -> {
                    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                }
                is MainEvent.Error -> {
                    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
                }
                // ...
            }
        }
    }
    
    // UI
    Column {
        if (uiState.isLoading) {
            CircularProgressIndicator()
        }
        
        currentTrack?.let { track ->
            TrackInfo(track)
        }
        
        Button(onClick = { viewModel.startRecording() }) {
            Text(if (uiState.isRecording) "–°—Ç–æ–ø" else "–°—Ç–∞—Ä—Ç")
        }
    }
}
```

---

## –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

### FileProvider

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (file_paths.xml):**

```xml
<?xml version="1.0" encoding="utf-8"?>
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- –¢—Ä–µ–∫–∏ (GPX/GeoJSON) -->
    <files-path name="tracks" path="tracks/" />
    
    <!-- –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ -->
    <files-path name="logs" path="logs/" />
    
    <!-- –ú–µ–¥–∏–∞ –∑–∞–º–µ—Ç–æ–∫ (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ) -->
    <files-path name="media" path="media/" />
    
    <!-- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö -->
    <external-files-path name="export" path="export/" />
</paths>
```

### –≠–∫—Å–ø–æ—Ä—Ç GPX

```kotlin
suspend fun exportTrackAsGpx(track: Track): Uri {
    val points = trackRepository.getTrackPoints(track.id).first()
    val gpxContent = GpxGenerator.generate(track, points)
    
    val file = File(context.filesDir, "tracks/${track.id}.gpx")
    file.parentFile?.mkdirs()
    file.writeText(gpxContent)
    
    return FileProvider.getUriForFile(
        context,
        "${context.packageName}.fileprovider",
        file
    )
}
```

### –ò–º–ø–æ—Ä—Ç GPX

```kotlin
suspend fun importTrackFromGpx(uri: Uri): Track {
    val inputStream = context.contentResolver.openInputStream(uri)
        ?: throw IOException("Cannot open file")
    
    val gpxContent = inputStream.bufferedReader().use { it.readText() }
    val gpxTrack = GpxParser.parse(gpxContent)
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Track –∏ TrackPoint
    val track = Track(
        id = UUID.randomUUID().toString(),
        name = gpxTrack.name ?: "Imported Track",
        startedAt = gpxTrack.startTime,
        endedAt = gpxTrack.endTime,
        distanceMeters = gpxTrack.distance,
        durationSec = gpxTrack.duration,
        elevationGainMeters = gpxTrack.elevationGain,
        gpxPath = null,
        geojsonPath = null,
        isRecording = false
    )
    
    trackRepository.insertTrack(track)
    
    gpxTrack.points.forEach { point ->
        trackRepository.insertTrackPoint(
            TrackPoint(
                id = UUID.randomUUID().toString(),
                trackId = track.id,
                timestamp = point.timestamp,
                latitude = point.latitude,
                longitude = point.longitude,
                altitude = point.altitude,
                speed = null,
                bearing = null,
                accuracy = 0f
            )
        )
    }
    
    return track
}
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞ –∑–∞–º–µ—Ç–æ–∫

```kotlin
suspend fun saveNoteMedia(uri: Uri, noteId: String, mediaType: MediaType): String {
    val extension = when (mediaType) {
        MediaType.PHOTO -> "jpg"
        MediaType.VIDEO -> "mp4"
    }
    
    val fileName = "${noteId}_${System.currentTimeMillis()}.$extension"
    val file = File(context.filesDir, "media/$fileName")
    file.parentFile?.mkdirs()
    
    context.contentResolver.openInputStream(uri)?.use { input ->
        file.outputStream().use { output ->
            input.copyTo(output)
        }
    }
    
    return file.absolutePath
}
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (AndroidManifest.xml)

```xml
<!-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ -->
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_LOCATION" />
<uses-permission android:name="android.permission.INTERNET" />

<!-- Android 10+ -->
<uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />

<!-- Android 13+ -->
<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

<!-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ -->
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.RECORD_AUDIO" />
```

### Gradle –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**build.gradle.kts (app):**

```kotlin
android {
    compileSdk = 34
    
    defaultConfig {
        applicationId = "com.xtrack"
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"
        
        // NDK —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è Yandex MapKit
        ndk {
            abiFilters += listOf("arm64-v8a", "armeabi-v7a", "x86", "x86_64")
        }
    }
    
    buildFeatures {
        compose = true
    }
    
    composeOptions {
        kotlinCompilerExtensionVersion = "1.5.14"
    }
    
    packaging {
        resources {
            excludes += "/META-INF/{AL2.0,LGPL2.1}"
        }
        jniLibs {
            useLegacyPackaging = true
        }
    }
}

kapt {
    correctErrorTypes = true
}
```

**gradle.properties:**

```properties
org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
org.gradle.parallel=true
org.gradle.caching=true
android.useAndroidX=true
kotlin.code.style=official
```

### ProGuard Rules

**proguard-rules.pro:**

```proguard
# Yandex MapKit
-keep class com.yandex.mapkit.** { *; }
-keep class com.yandex.runtime.** { *; }
-dontwarn com.yandex.mapkit.**

# Room
-keep class * extends androidx.room.RoomDatabase
-keep @androidx.room.Entity class *
-dontwarn androidx.room.paging.**

# Hilt
-keep class dagger.hilt.** { *; }
-keep class javax.inject.** { *; }

# Gson
-keepattributes Signature
-keepattributes *Annotation*
-keep class com.xtrack.data.model.** { *; }

# Coroutines
-keepnames class kotlinx.coroutines.internal.MainDispatcherFactory {}
-keepnames class kotlinx.coroutines.CoroutineExceptionHandler {}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests

**TrackRepositoryTest:**

```kotlin
@RunWith(MockitoJUnitRunner::class)
class TrackRepositoryTest {
    
    @Mock
    private lateinit var trackDao: TrackDao
    
    @Mock
    private lateinit var trackPointDao: TrackPointDao
    
    private lateinit var repository: TrackRepository
    
    @Before
    fun setup() {
        repository = TrackRepository(trackDao, trackPointDao)
    }
    
    @Test
    fun `getAllTracks returns flow of tracks`() = runTest {
        val tracks = listOf(
            Track(
                id = "1",
                name = "Test Track",
                startedAt = Clock.System.now(),
                endedAt = null,
                distanceMeters = 0.0,
                durationSec = 0,
                elevationGainMeters = 0.0,
                gpxPath = null,
                geojsonPath = null,
                isRecording = true
            )
        )
        
        `when`(trackDao.getAllTracks()).thenReturn(flowOf(tracks))
        
        val result = repository.getAllTracks().first()
        
        assertEquals(tracks, result)
        verify(trackDao).getAllTracks()
    }
}
```

**LocationUtilsTest:**

```kotlin
class LocationUtilsTest {
    
    @Test
    fun `calculateDistance returns correct distance`() {
        // –ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –ø—Ä–∏–º–µ—Ä–Ω–æ 634 –∫–º
        val moscowLat = 55.751244
        val moscowLng = 37.618423
        val spbLat = 59.934280
        val spbLng = 30.335098
        
        val distance = LocationUtils.calculateDistance(
            moscowLat, moscowLng, spbLat, spbLng
        )
        
        // –î–æ–ø—É—Å–∫ ¬±10 –∫–º
        assertTrue(distance in 624000f..644000f)
    }
    
    @Test
    fun `formatDistance formats correctly`() {
        assertEquals("0 –º", LocationUtils.formatDistance(0f))
        assertEquals("50 –º", LocationUtils.formatDistance(50f))
        assertEquals("1.0 –∫–º", LocationUtils.formatDistance(1000f))
        assertEquals("5.4 –∫–º", LocationUtils.formatDistance(5432f))
    }
}
```

### UI Tests (Espresso + Compose)

**MainScreenTest:**

```kotlin
@RunWith(AndroidJUnit4::class)
class MainScreenTest {
    
    @get:Rule
    val composeTestRule = createComposeRule()
    
    @Test
    fun startButton_isDisplayed() {
        composeTestRule.setContent {
            MainScreen(
                viewModel = FakeMainViewModel(),
                onNavigateToTracks = {},
                onNavigateToSettings = {}
            )
        }
        
        composeTestRule
            .onNodeWithText("–°—Ç–∞—Ä—Ç")
            .assertIsDisplayed()
    }
    
    @Test
    fun clickStartButton_startsRecording() {
        val viewModel = FakeMainViewModel()
        
        composeTestRule.setContent {
            MainScreen(
                viewModel = viewModel,
                onNavigateToTracks = {},
                onNavigateToSettings = {}
            )
        }
        
        composeTestRule
            .onNodeWithText("–°—Ç–∞—Ä—Ç")
            .performClick()
        
        assertTrue(viewModel.isRecordingCalled)
    }
}
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**XTrack** - —ç—Ç–æ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è GPS-—Ç—Ä–µ–∫–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ best practices Android —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **Clean Architecture** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ (Data, Domain, Presentation)
2. **MVVM –ø–∞—Ç—Ç–µ—Ä–Ω** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ UI
3. **Dependency Injection (Hilt)** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
4. **Room Database** - –Ω–∞–¥–µ–∂–Ω–æ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
5. **Jetpack Compose** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π UI
6. **Coroutines & Flow** - —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
7. **Foreground Services** - –Ω–∞–¥–µ–∂–Ω–∞—è —Ñ–æ–Ω–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ—á–µ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è GPS-—Ç–æ—á–µ–∫ –ø–æ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å Paging
- Rate-limited –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:

- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:

- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Dependency Injection –¥–ª—è –ø–æ–¥–º–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0  
**–î–∞—Ç–∞:** 10 –æ–∫—Ç—è–±—Ä—è 2024  
**–ê–≤—Ç–æ—Ä:** XTrack Development Team

