# Руководство по тестированию TrackingApp

## Быстрый старт

### 1. Подготовка окружения

```bash
# Клонируйте проект
git clone <repository-url>
cd TrackingApp

# Откройте в Android Studio
# File → Open → выберите папку TrackingApp
```

### 2. Настройка Яндекс MapKit API

1. Перейдите в [Кабинет разработчика Яндекс](https://developer.tech.yandex.ru/)
2. Создайте новый проект или выберите существующий
3. Подключите MapKit Mobile SDK
4. Создайте API ключ
5. Добавьте ключ в `app/src/main/res/values/strings.xml`:

```xml
<string name="yandex_maps_key">YOUR_ACTUAL_YANDEX_API_KEY_HERE</string>
```

### 3. Настройка эмулятора

#### Создание AVD
1. **Tools → AVD Manager**
2. **Create Virtual Device**
3. **Выберите устройство** (например, Pixel 4)
4. **Выберите системный образ** (API 30+)
5. **Настройте AVD**:
   - Name: `TrackingApp_Test`
   - Advanced Settings → Camera: Webcam0 (для тестирования камеры)

#### Настройка GPS в эмуляторе
1. **Запустите эмулятор**
2. **Откройте Extended Controls** (кнопка "..." в панели)
3. **Location → Single Points**
4. **Добавьте тестовые координаты**:
   - Latitude: `55.751244`
   - Longitude: `37.618423`
   - Нажмите "Send"

## Пошаговое тестирование

### Этап 1: Базовое тестирование

#### 1.1 Запуск приложения
```bash
# Через Android Studio
# Нажмите зеленую кнопку "Run" или Shift + F10

# Через командную строку
./gradlew installDebug
```

**Ожидаемый результат:**
- Приложение запускается
- Отображается экран с запросом разрешений
- Кнопки навигации видны

#### 1.2 Предоставление разрешений
1. **Нажмите "Предоставить разрешение"**
2. **Разрешите доступ к местоположению**
3. **Для Android 10+: разрешите фоновое местоположение**

**Ожидаемый результат:**
- Переход на главный экран
- Отображение карты
- Кнопка "Начать запись" активна

### Этап 2: Тестирование записи GPS

#### 2.1 Начало записи
1. **Нажмите зеленую кнопку "Начать запись"**
2. **Проверьте уведомление** в панели уведомлений
3. **Проверьте изменение кнопки** на красную "Остановить"

**Ожидаемый результат:**
- Появление уведомления "Запись маршрута"
- Кнопка стала красной
- Статистика показывает время записи

#### 2.2 Эмуляция движения
1. **В Extended Controls → Location**
2. **Добавьте несколько точек** для имитации движения:
   ```
   Point 1: 55.751244, 37.618423
   Point 2: 55.752244, 37.619423
   Point 3: 55.753244, 37.620423
   ```
3. **Отправляйте точки** с интервалом 5-10 секунд

**Ожидаемый результат:**
- Обновление статистики (дистанция, время)
- Появление трека на карте
- Увеличение количества точек

#### 2.3 Фоновая работа
1. **Сверните приложение** (кнопка Home)
2. **Заблокируйте экран**
3. **Подождите 1-2 минуты**
4. **Разблокируйте и откройте приложение**

**Ожидаемый результат:**
- Уведомление остается активным
- Запись продолжается
- Новые точки добавляются

#### 2.4 Остановка записи
1. **Откройте приложение**
2. **Нажмите красную кнопку "Остановить"**
3. **Проверьте исчезновение уведомления**

**Ожидаемый результат:**
- Уведомление исчезает
- Кнопка становится зеленой
- Маршрут сохраняется

### Этап 3: Тестирование просмотра маршрутов

#### 3.1 Список маршрутов
1. **Нажмите кнопку "Маршруты"** (иконка списка)
2. **Проверьте отображение** сохраненного маршрута

**Ожидаемый результат:**
- Маршрут отображается в списке
- Показывается название, дата, дистанция, длительность

#### 3.2 Поиск маршрутов
1. **Введите название** в поле поиска
2. **Проверьте фильтрацию** результатов

**Ожидаемый результат:**
- Список фильтруется по введенному тексту
- При пустом поиске показываются все маршруты

#### 3.3 Сортировка маршрутов
1. **Нажмите кнопку сортировки** (иконка сортировки)
2. **Выберите разные варианты**:
   - По дате (новые/старые)
   - По дистанции (больше/меньше)
   - По длительности
   - По названию

**Ожидаемый результат:**
- Список пересортировывается согласно выбранному критерию

### Этап 4: Тестирование детального просмотра

#### 4.1 Открытие маршрута
1. **Нажмите на маршрут** в списке
2. **Проверьте отображение** детального экрана

**Ожидаемый результат:**
- Открывается экран с картой
- Трек отображается на карте
- Показывается подробная статистика

#### 4.2 Экспорт GPX
1. **Нажмите кнопку "Поделиться"**
2. **Выберите "Экспорт GPX"**
3. **Выберите приложение** для отправки (например, Gmail)

**Ожидаемый результат:**
- Создается GPX файл
- Открывается диалог выбора приложения
- Файл можно отправить

#### 4.3 Экспорт GeoJSON
1. **Повторите шаги** для GeoJSON
2. **Проверьте создание** GeoJSON файла

**Ожидаемый результат:**
- Создается GeoJSON файл
- Файл валиден и может быть открыт в сторонних приложениях

### Этап 5: Тестирование настроек

#### 5.1 Открытие настроек
1. **Нажмите кнопку "Настройки"** (иконка шестеренки)
2. **Проверьте отображение** всех опций

**Ожидаемый результат:**
- Отображаются все настройки
- Текущие значения корректны

#### 5.2 Изменение настроек
1. **Измените точность** местоположения
2. **Измените интервал** обновления
3. **Измените минимальную дистанцию**
4. **Перезапустите приложение**

**Ожидаемый результат:**
- Настройки сохраняются
- Применяются при следующей записи

## Автоматизированное тестирование

### Unit тесты

```bash
# Запуск всех unit тестов
./gradlew test

# Запуск с покрытием кода
./gradlew testDebugUnitTestCoverage

# Просмотр отчета о покрытии
open app/build/reports/jacoco/testDebugUnitTestCoverage/html/index.html
```

### Инструментальные тесты

```bash
# Запуск UI тестов
./gradlew connectedAndroidTest

# Запуск конкретного теста
./gradlew connectedAndroidTest --tests "com.trackingapp.ui.MainActivityTest"
```

### Тестирование базы данных

```bash
# Запуск тестов Room
./gradlew connectedAndroidTest --tests "com.trackingapp.database.*"
```

## Тестирование производительности

### Мониторинг батареи

```bash
# Сброс статистики батареи
adb shell dumpsys batterystats --reset

# Используйте приложение 10-15 минут

# Сбор статистики
adb shell dumpsys batterystats > batterystats.txt

# Анализ через Battery Historian
# Загрузите файл на https://battery-historian.appspot.com/
```

### Мониторинг памяти

1. **Откройте Profiler** в Android Studio
2. **Выберите Memory**
3. **Запустите приложение**
4. **Проверьте**:
   - Использование памяти
   - Утечки памяти
   - GC активность

### Мониторинг CPU

1. **В Profiler выберите CPU**
2. **Запустите приложение**
3. **Проверьте**:
   - Использование CPU
   - Время выполнения методов
   - Потоки

## Тестирование на разных устройствах

### Матрица тестирования

| Android версия | API Level | Устройство | Статус |
|----------------|-----------|------------|--------|
| 7.0 | 24 | Emulator | ✅ |
| 8.0 | 26 | Emulator | ✅ |
| 9.0 | 28 | Emulator | ✅ |
| 10 | 29 | Emulator | ✅ |
| 11 | 30 | Emulator | ✅ |
| 12 | 31 | Emulator | ✅ |
| 13 | 33 | Emulator | ✅ |
| 14 | 34 | Emulator | ✅ |

### Тестирование на реальных устройствах

#### Настройка устройства
1. **Включите режим разработчика**:
   - Settings → About Phone → Build Number (7 раз)
2. **Включите отладку по USB**:
   - Settings → Developer Options → USB Debugging
3. **Подключите устройство** к компьютеру
4. **Разрешите отладку** на устройстве

#### Установка приложения
```bash
# Установка на подключенное устройство
./gradlew installDebug

# Проверка подключенных устройств
adb devices
```

## Отладка и логирование

### Просмотр логов

```bash
# Все логи приложения
adb logcat | grep "TrackingApp"

# Логи сервиса
adb logcat | grep "LocationTrackingService"

# Логи ViewModel
adb logcat | grep "MainViewModel"

# Очистка логов
adb logcat -c
```

### Настройка логирования

Добавьте в код для отладки:

```kotlin
import android.util.Log

private const val TAG = "TrackingApp"

Log.d(TAG, "Debug message")
Log.i(TAG, "Info message")
Log.w(TAG, "Warning message")
Log.e(TAG, "Error message")
```

### Точки останова

1. **Установите breakpoint** (клик на номере строки)
2. **Запустите в debug режиме** (Shift + F9)
3. **Используйте Debugger**:
   - Step Over (F8)
   - Step Into (F7)
   - Step Out (Shift + F8)
   - Resume (F9)

## Тестирование экспорта/импорта

### Валидация GPX файлов

```bash
# Проверка XML структуры
xmllint --noout exported_track.gpx

# Валидация GPX схемы
xmllint --schema gpx-1.1.xsd exported_track.gpx
```

### Валидация GeoJSON файлов

```bash
# Проверка JSON структуры
python -m json.tool exported_track.geojson

# Валидация GeoJSON
# Используйте https://geojson.io/ или https://geojsonlint.com/
```

### Тестирование в сторонних приложениях

#### GPX файлы
- **Locus Map**: Импорт → GPX → Выберите файл
- **OsmAnd**: Меню → Импорт/Экспорт → GPX
- **Strava**: Веб-интерфейс → Upload → GPX

#### GeoJSON файлы
- **QGIS**: Layer → Add Layer → Add Vector Layer
- **GeoJSON.io**: Drag & Drop файла
- **Leaflet**: Используйте в веб-приложении

## Чек-лист тестирования

### ✅ Основной функционал
- [ ] Запуск приложения
- [ ] Предоставление разрешений
- [ ] Начало записи GPS
- [ ] Остановка записи
- [ ] Просмотр списка маршрутов
- [ ] Детальный просмотр маршрута
- [ ] Экспорт GPX
- [ ] Экспорт GeoJSON
- [ ] Настройки приложения

### ✅ Производительность
- [ ] Расход батареи (разумный)
- [ ] Использование памяти (без утечек)
- [ ] Плавность UI (60 FPS)
- [ ] Время отклика (< 100ms)

### ✅ Совместимость
- [ ] Android 7.0+ (API 24+)
- [ ] Разные размеры экрана
- [ ] Поворот экрана
- [ ] Темная/светлая тема

### ✅ Надежность
- [ ] Восстановление после убийства процесса
- [ ] Работа без интернета
- [ ] Обработка ошибок GPS
- [ ] Валидация данных

### ✅ Безопасность
- [ ] Локальная обработка данных
- [ ] Безопасный экспорт файлов
- [ ] Минимальные разрешения
- [ ] Защита от SQL-инъекций

## Решение проблем

### Проблема: Карта не отображается
**Решение:**
1. Проверьте API ключ Яндекс MapKit в `strings.xml`
2. Убедитесь, что MapKit инициализирован в MainActivity
3. Проверьте вызов onStart()/onStop() для MapKit
4. Проверьте логи: `adb logcat | grep MapKit`

### Проблема: GPS не работает в эмуляторе
**Решение:**
1. Настройте координаты в Extended Controls
2. Проверьте разрешения на местоположение
3. Убедитесь, что GPS включен в настройках эмулятора

### Проблема: Уведомления не отображаются
**Решение:**
1. Проверьте настройки уведомлений приложения
2. Убедитесь, что канал уведомлений создан
3. Проверьте разрешения на уведомления

### Проблема: Экспорт файлов не работает
**Решение:**
1. Проверьте разрешения на запись
2. Убедитесь в корректности FileProvider
3. Проверьте доступное место на диске

## Полезные команды

```bash
# Очистка проекта
./gradlew clean

# Пересборка
./gradlew rebuild

# Установка на устройство
./gradlew installDebug

# Запуск тестов
./gradlew test

# Проверка кода
./gradlew lint

# Анализ зависимостей
./gradlew app:dependencies

# Просмотр подключенных устройств
adb devices

# Перезапуск ADB
adb kill-server && adb start-server

# Очистка данных приложения
adb shell pm clear com.trackingapp

# Установка APK
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

